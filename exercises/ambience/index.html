<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rainbow Circles</title>
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #151525;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: absolute;
            animation: move 0s alternate, immediateChange 4s infinite;
            opacity: 0;
        }

        @keyframes immediateChange {
            0% { background-color: blue; }
            50% { background-color: red; }
            100% { background-color: green; }
        }

    </style>
</head>

<body>
    <div class="container"></div>

    <script>
        const container = document.querySelector('.container');
        const numRows = 11;
        const numColumns = 11;
        const centerRow = Math.floor(numRows / 2);
        const maxRadius = 50;
        const maxRowFactor = Math.pow(centerRow, 2);
        const speed = 8;

        function getRainbowColor(index, total) {
            const hue = (index / total) * 360; // Calculate the hue based on index
            return `hsl(${hue}, 100%, 50%)`; // Full saturation, 50% lightness for vibrant colors
        }

        // Generate rows of circles programmatically
        for (let row = 0; row < numRows; row++) {
            const rowHeight = (100 / numRows);  // Calculate the top position of the row
            const rowFactor = Math.pow(row - centerRow, 2) * 25 / maxRowFactor;
            const animationDuration = ((25 + rowFactor) / maxRadius) * 4;

            for (let col = 0; col < numColumns; col++) {
                const animationDelay = (col / numColumns) * speed;

                const circle = document.createElement('div');
                circle.classList.add('circle');
                circle.style.backgroundColor = getRainbowColor(col + numColumns, numColumns);

                circle.style.top = `calc(${(row * rowHeight)}vh + 25px)`; // +25px to center it vertically

                circle.style.animationDelay = `${animationDelay}s`;

                circle.style.animationName = `move-row-${row}-${col}`;

                // Create dynamic keyframe style
                const styleSheet = document.styleSheets[0];
                const keyframes = `
                @keyframes move-row-${row}-${col} {
                    0% {
                        left: calc(50vw - 25px);
                        animation-timing-function: ease-out;
                    }
                    25% {
                        left: calc(${100 - rowFactor}vw - 50px);
                        animation-timing-function: ease-in;
                    }
                    50% {
                        left: calc(50vw - 25px);
                        animation-timing-function: ease-out;
                    }
                    75% {
                        left: calc(${rowFactor}vw);
                        animation-timing-function: ease-in;
                    }
                    100% {
                        left: calc(50vw - 25px);
                        animation-timing-function: ease-out;
                    }
                }`;
                styleSheet.insertRule(keyframes, styleSheet.cssRules.length);

                circle.addEventListener('animationend', () => {
                    circle.style.animationDelay = `${0}s`;
                    circle.style.animationDuration = `${speed}s`;
                    circle.style.opacity = 1;
                    container.appendChild(circle); 
                });

                container.appendChild(circle);
            }
        }
    </script>
</body>

</html>